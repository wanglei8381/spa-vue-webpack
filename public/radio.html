<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>电台分享</title>
    <link rel="stylesheet" href="css/ui-base.css">
    <link rel="stylesheet" href="css/common.css">
    <script src="js/resetFontSize.js?375"></script>

</head>
<body ontouchstart>

<!--radio start-->
<audio id="audiosrc" class="uhide" src="" controls="controls">
    Your browser does not support the audio element.
</audio>

<!--页面上滑到一定高度后显示播放效果-->
<div class="fixedPlay ub ub-ac ub-pc uhide">
    <div class="ub-f1 ub-ver fixedTitle">
        <div class="ub-f1 titleR"></div>
        <div class="ub-f1 fixedPlayTime"><span class="musicPlayTimesC">00 : 00</span> / <span
                class="musicTime">00 : 00</span></div>
    </div>
    <div class="ub-img fixedPlayIcon fiexedPlay"></div>
</div>

<div class="ub ub-ver ub-ac ub-pc">
    <div class="ub radioTop ub-img ub-ac ub-pc">
        <img src="" class="musicImgWH" alt="">
    </div>
    <div class="ub-img radioPlay2 radioPlayT"></div>
    <div class="playTime"><span class="musicPlayTimesC">00 : 00</span> / <span class="musicTime">00 : 00</span></div>
    <div class="radioTitle titleR"></div>
    <div class="radioAnchor">主播: <span class="Anchor"></span></div>
</div>
<div class="playNumbers">播放: <span class="plays"></span></div>

<div class="commonSpace"></div>

<div class="radio">
    <div class="radioContentAuthor">文:&nbsp;by&nbsp; <span class="spaceName"></span></div>
    <hr class="radioHr">
    <div class="radioContent">
    </div>
    <div class="more ub ub-ver ub-ac uhide">
        <div>查看全部</div>
        <div class="ub-img moredown"></div>
    </div>
</div>
<!--radio end-->

<div class="commonSpace"></div>

<div class="appDown ub ub-ver ub-ac">
    <div class="ub-img appImage"></div>
    <div class="ub appText">
        <div>打开片刻APP</div>
        <div class="appComma">,</div>
        <div>下载收听该电台</div>
    </div>
</div>

<script src="js/zepto.js"></script>
<script src="js/md5.js"></script>
<script src="js/jquery.base64.js"></script>
<script src="js/common.js"></script>
<script>
    var isplay = 0;
    $(function () {
        $(window).scroll(function () {
            var a = document.body.scrollTop;
            if (a > 300) {
                $('.fixedPlay').removeClass('uhide');
                playStatus();
            } else {
                $('.fixedPlay').addClass('uhide');
                playStatus();
            }
        })
    })

    function playStatus() {
        if (isplay == 1) {
            $('.radioTop').addClass('playAnimation');
            $('.radioTop').css('animation-play-state', 'running');
            $('.radioPlay2').addClass('radioPlayF');
            $('.radioPlay2').removeClass('radioPlayT');
            $('.fiexedPlay').addClass('fixedPauseIcon');
            $('.fiexedPlay').removeClass('fixedPlayIcon');
        } else {
            $('.radioTop').css('animation-play-state', 'paused');
            $('.radioPlay2').removeClass('radioPlayF');
            $('.radioPlay2').addClass('radioPlayT');
            $('.fiexedPlay').removeClass('fixedPauseIcon');
            $('.fiexedPlay').addClass('fixedPlayIcon');
        }
    }


    //请求接口,获取电台详情信息
    /*var id = '5734954b723125fa558b4603';
     R.ajax({
     url: 'ting/info.php',
     data: {
     tingid: id
     },
     success: function (data) {
     showTingInfo(data)
     }
     });*/
    showTingInfo();
    function showTingInfo() {
        $('.radioTop img').attr('src', tingData.imgUrl)
        $('.titleR').html(tingData.title);
        $('.Anchor').html(tingData.userinfo.uname);
        $('.plays').html(tingData.plays);
        $('.spaceName').html(tingData.collInfo.spaceName);


        var idIndex = tingData.webview_url.lastIndexOf('/');
        var tingAriticleId = tingData.webview_url.substring(idIndex + 1);
        showTingArticleInfo(tingAriticleId);

        $('#audiosrc').attr('src', tingData.musicUrl);
        playCotrol(); //播放控制函数
    }

    function playCotrol() {
        var audio = document.getElementById("audiosrc");
        audio.addEventListener("loadeddata", //歌曲一经完整的加载完毕()
                function () {
                    var allTime = audio.duration;
                    timeChange(allTime, "musicTime");
                    setInterval(function () {
                        var currentTime = audio.currentTime;
                        timeChange(currentTime, "musicPlayTimesC");
                    }, 1000);
                }, false);
        audio.addEventListener("ended", function () {
            $('.radioPlay2').removeClass('radioPlayF');
            $('.radioPlay2').addClass('radioPlayT');
        }, false)

        $('.radioPlay2').click(function () {
            if (isplay == 1) {
                //停止旋转,停止播放
                audiosrc.pause();
                $('.radioTop').css('animation-play-state', 'paused');
                isplay = 0;
                $('.radioPlay2').removeClass('radioPlayF');
                $('.radioPlay2').addClass('radioPlayT');
            } else {
                //旋转,播放
                audiosrc.play();
                $('.radioTop').css('animation-play-state', 'running');
                $('.radioTop').addClass('playAnimation');
                isplay = 1;
                $('.radioPlay2').addClass('radioPlayF');
                $('.radioPlay2').removeClass('radioPlayT');
            }

        })
        $('.fiexedPlay').click(function () {
            if (isplay == 1) {
                //停止旋转,停止播放
                audiosrc.pause();
                isplay = 0;
                $('.fiexedPlay').removeClass('fixedPauseIcon');
                $('.fiexedPlay').addClass('fixedPlayIcon');
            } else {
                //旋转,播放
                audiosrc.play();
                isplay = 1;
                $('.fiexedPlay').addClass('fixedPauseIcon');
                $('.fiexedPlay').removeClass('fixedPlayIcon');
            }
        })

    }

    //播放时间
    function timeChange(time, timePlace) {
        //分钟
        var minute = time / 60;
        var minutes = parseInt(minute);
        if (minutes < 10) {
            minutes = "0" + minutes;
        }
        //秒
        var second = time % 60;
        seconds = parseInt(second);
        if (seconds < 10) {
            seconds = "0" + seconds;
        }
        var allTime = "" + minutes + "" + " : " + "" + seconds + ""
        $('.' + timePlace).html(allTime);
    }


    function showTingArticleInfo(){
        //请求接口,获取电台原文
        /*R.ajax({
         url: 'article/editableInfo.php',
         data: {
         id: tingAriticleId
         },
         success: function (data) {
         showTingArticleInfo(data)
         }
         });*/


        var tingContent = '';
        $.each(tingArticleData.content,function(idx,item){
            tingContent += '<p>'+ item.content +'</p>';
        })
        $('.radioContent').html(tingContent);
        contentCols($('.radioContent'),20);
    }

</script>
</body>
</html>